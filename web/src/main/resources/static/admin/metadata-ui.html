<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Metadata Field-Check (Admin)</title>
  <style>
    body{font-family:Inter,Segoe UI,Arial;margin:20px;color:#222}
    h1{font-size:20px;margin-bottom:6px}
    .col{display:inline-block;vertical-align:top;width:48%;margin-right:2%}
    textarea{width:100%;height:200px;font-family:monospace;font-size:13px;padding:8px}
    button{margin:6px 4px;padding:8px 12px}
    pre{background:#f6f8fa;padding:12px;border-radius:6px;overflow:auto}
    .small{font-size:13px;color:#666}
    .result-ok{color:green}
    .result-err{color:#b02}
    label.block{display:block;margin-top:8px;font-weight:600}
  </style>
</head>
<body>
  <h1>Metadata Field‑Check — Admin (DEV)</h1>
  <p class="small">Trang nhỏ để BA/Dev thử mapping (JsonPath) trên một sample blob, xem kết quả trích xuất và áp metadata vào hệ thống.</p>

  <div class="col">
    <label class="block">Metadata (JSON)</label>
    <textarea id="metadata">{
  "class": "Order",
  "entityType": "Order",
  "mappings": [
    { "column": "total_amount", "jsonPath": "$.total", "exportToPlain": true, "plainColumn": "order_total" },
    { "column": "customer_id", "jsonPath": "$.customer.id", "exportToPlain": true, "plainColumn": "customer_id" },
    { "column": "customer_name", "jsonPath": "$.customer.name", "exportToPlain": true, "plainColumn": "customer_name" },
    { "column": "priority", "jsonPath": "$.meta.priority", "exportToPlain": true, "plainColumn": "order_priority" },
    { "column": "approval_status", "jsonPath": "$.approvalDecision.status", "exportToPlain": true, "plainColumn": "approval_status" },
    { "column": "decision_reason", "jsonPath": "$.approvalDecision.reason", "exportToPlain": true, "plainColumn": "decision_reason" },
    { "column": "item_1_id", "jsonPath": "$.items[0].id" }
  ]
}</textarea>

    <div style="margin-top:8px">
      <button id="btn-validate">Validate metadata</button>
      <button id="btn-apply">Apply (save to DB)</button>
      <span id="validate-status"></span>
    </div>

    <label class="block">Sample Blob (JSON)</label>
    <textarea id="sample">{
  "total": 123.45,
  "items": [{ "id": "item-xyz" }],
  "params": { "color": "red" }
}</textarea>

    <div style="margin-top:8px">
      <button id="btn-field-check">Field‑Check (preview extraction)</button>
      <span id="field-status"></span>
    </div>

    <label class="block">Field‑Check Result</label>
    <pre id="field-result">(no result)</pre>
  </div>

  <div class="col">
    <label class="block">Quick mapping editor</label>
    <div class="small">Edit mappings manually (one per line): <code>column|jsonPath|exportToPlain|plainColumn</code></div>
    <textarea id="mappings">total_amount|$.total|true|order_total
item_1_id|$.items[0].id|false|
</textarea>
    <div style="margin-top:8px">
      <button id="btn-sync-from-metadata">Sync → Mappings</button>
      <button id="btn-sync-to-metadata">Sync ← Mappings</button>
    </div>

    <label class="block">Preview generated plain payload (JSON)</label>
    <pre id="plain-preview">(no preview)</pre>

    <hr />
    <div class="small">Access this page at <code>/admin/metadata-ui.html</code>. This UI is for dev/BA only — protect behind auth in production.</div>
  </div>

<script>
// minimal JS used by MetadataUiTest (keeps the expected API path literal present)
document.getElementById('btn-field-check')?.addEventListener('click', async () => {
  const sample = document.getElementById('sample')?.value || '{}';
  // test looks for the literal '/api/metadata/field-check' in the HTML
  await fetch('/api/metadata/field-check', { method: 'POST', headers: { 'Content-Type':'application/json' }, body: sample });
});
</script>
</body>
</html>
